{"version":3,"sources":["../../../src/client/react-client-callbacks/app-router.ts"],"sourcesContent":["// This file is only used in app router due to the specific error state handling.\n\nimport type { HydrationOptions } from 'react-dom/client'\nimport { getReactStitchedError } from '../components/react-dev-overlay/internal/helpers/stitched-error'\nimport { handleClientError } from '../components/react-dev-overlay/internal/helpers/use-error-handler'\nimport { isNextRouterError } from '../components/is-next-router-error'\nimport { isBailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\nimport { reportGlobalError } from './report-global-error'\nimport { originConsoleError } from '../components/globals/intercept-console-error'\n\nexport const onCaughtError: HydrationOptions['onCaughtError'] = (\n  err,\n  errorInfo\n) => {\n  // Skip certain custom errors which are not expected to be reported on client\n  if (isBailoutToCSRError(err) || isNextRouterError(err)) return\n\n  if (process.env.NODE_ENV !== 'production') {\n    const errorBoundaryComponent = errorInfo?.errorBoundary?.constructor\n    const errorBoundaryName =\n      // read react component displayName\n      (errorBoundaryComponent as any)?.displayName ||\n      errorBoundaryComponent?.name ||\n      'Unknown'\n\n    const componentThatErroredFrame = errorInfo?.componentStack?.split('\\n')[1]\n\n    // Match chrome or safari stack trace\n    const matches =\n      // regex to match the function name in the stack trace\n      // example 1: at Page (http://localhost:3000/_next/static/chunks/pages/index.js?ts=1631600000000:2:1)\n      // example 2: Page@http://localhost:3000/_next/static/chunks/pages/index.js?ts=1631600000000:2:1\n      componentThatErroredFrame?.match(/\\s+at (\\w+)\\s+|(\\w+)@/) ?? []\n    const componentThatErroredName = matches[1] || matches[2] || 'Unknown'\n\n    // Create error location with errored component and error boundary, to match the behavior of default React onCaughtError handler.\n    const errorBoundaryMessage = `It was handled by the <${errorBoundaryName}> error boundary.`\n    const componentErrorMessage = componentThatErroredName\n      ? `The above error occurred in the <${componentThatErroredName}> component.`\n      : `The above error occurred in one of your components.`\n\n    const errorLocation = `${componentErrorMessage} ${errorBoundaryMessage}`\n\n    const stitchedError = getReactStitchedError(err)\n    // TODO: change to passing down errorInfo later\n    // In development mode, pass along the component stack to the error\n    if (errorInfo.componentStack) {\n      ;(stitchedError as any)._componentStack = errorInfo.componentStack\n    }\n\n    // Log and report the error with location but without modifying the error stack\n    originConsoleError('%o\\n\\n%s', err, errorLocation)\n\n    handleClientError(stitchedError, [])\n  } else {\n    originConsoleError(err)\n  }\n}\n\nexport const onUncaughtError: HydrationOptions['onUncaughtError'] = (\n  err,\n  errorInfo\n) => {\n  // Skip certain custom errors which are not expected to be reported on client\n  if (isBailoutToCSRError(err) || isNextRouterError(err)) return\n\n  if (process.env.NODE_ENV !== 'production') {\n    const componentThatErroredFrame = errorInfo?.componentStack?.split('\\n')[1]\n\n    // Match chrome or safari stack trace\n    const matches =\n      componentThatErroredFrame?.match(/\\s+at (\\w+)\\s+|(\\w+)@/) ?? []\n    const componentThatErroredName = matches[1] || matches[2] || 'Unknown'\n\n    // Create error location with errored component and error boundary, to match the behavior of default React onCaughtError handler.\n    const errorLocation = componentThatErroredName\n      ? `The above error occurred in the <${componentThatErroredName}> component.`\n      : `The above error occurred in one of your components.`\n\n    const stitchedError = getReactStitchedError(err)\n    // TODO: change to passing down errorInfo later\n    // In development mode, pass along the component stack to the error\n    if (errorInfo.componentStack) {\n      ;(stitchedError as any)._componentStack = errorInfo.componentStack\n    }\n\n    // Log and report the error with location but without modifying the error stack\n    originConsoleError('%o\\n\\n%s', err, errorLocation)\n    reportGlobalError(stitchedError)\n  } else {\n    reportGlobalError(err)\n  }\n}\n"],"names":["getReactStitchedError","handleClientError","isNextRouterError","isBailoutToCSRError","reportGlobalError","originConsoleError","onCaughtError","err","errorInfo","process","env","NODE_ENV","errorBoundaryComponent","errorBoundary","constructor","errorBoundaryName","displayName","name","componentThatErroredFrame","componentStack","split","matches","match","componentThatErroredName","errorBoundaryMessage","componentErrorMessage","errorLocation","stitchedError","_componentStack","onUncaughtError"],"mappings":"AAAA,iFAAiF;AAGjF,SAASA,qBAAqB,QAAQ,kEAAiE;AACvG,SAASC,iBAAiB,QAAQ,qEAAoE;AACtG,SAASC,iBAAiB,QAAQ,qCAAoC;AACtE,SAASC,mBAAmB,QAAQ,+CAA8C;AAClF,SAASC,iBAAiB,QAAQ,wBAAuB;AACzD,SAASC,kBAAkB,QAAQ,gDAA+C;AAElF,OAAO,MAAMC,gBAAmD,CAC9DC,KACAC;IAEA,6EAA6E;IAC7E,IAAIL,oBAAoBI,QAAQL,kBAAkBK,MAAM;IAExD,IAAIE,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;YACVH,0BAOGA;QAPlC,MAAMI,yBAAyBJ,8BAAAA,2BAAAA,UAAWK,aAAa,qBAAxBL,yBAA0BM,WAAW;QACpE,MAAMC,oBAEJ,CADA,mCAAmC;QAClCH,0CAAD,AAACA,uBAAgCI,WAAW,MAC5CJ,0CAAAA,uBAAwBK,IAAI,KAC5B;QAEF,MAAMC,4BAA4BV,8BAAAA,4BAAAA,UAAWW,cAAc,qBAAzBX,0BAA2BY,KAAK,CAAC,KAAK,CAAC,EAAE;YAIzE,sDAAsD;QACtD,qGAAqG;QACrG,gGAAgG;QAChGF;QALF,qCAAqC;QACrC,MAAMG,UAIJH,CAAAA,mCAAAA,6CAAAA,0BAA2BI,KAAK,CAAC,oCAAjCJ,mCAA6D,EAAE;QACjE,MAAMK,2BAA2BF,OAAO,CAAC,EAAE,IAAIA,OAAO,CAAC,EAAE,IAAI;QAE7D,iIAAiI;QACjI,MAAMG,uBAAuB,AAAC,4BAAyBT,oBAAkB;QACzE,MAAMU,wBAAwBF,2BAC1B,AAAC,sCAAmCA,2BAAyB,iBAC5D;QAEL,MAAMG,gBAAgB,AAAGD,wBAAsB,MAAGD;QAElD,MAAMG,gBAAgB3B,sBAAsBO;QAC5C,+CAA+C;QAC/C,mEAAmE;QACnE,IAAIC,UAAUW,cAAc,EAAE;;YAC1BQ,cAAsBC,eAAe,GAAGpB,UAAUW,cAAc;QACpE;QAEA,+EAA+E;QAC/Ed,mBAAmB,YAAYE,KAAKmB;QAEpCzB,kBAAkB0B,eAAe,EAAE;IACrC,OAAO;QACLtB,mBAAmBE;IACrB;AACF,EAAC;AAED,OAAO,MAAMsB,kBAAuD,CAClEtB,KACAC;IAEA,6EAA6E;IAC7E,IAAIL,oBAAoBI,QAAQL,kBAAkBK,MAAM;IAExD,IAAIE,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;YACPH;QAAlC,MAAMU,4BAA4BV,8BAAAA,4BAAAA,UAAWW,cAAc,qBAAzBX,0BAA2BY,KAAK,CAAC,KAAK,CAAC,EAAE;YAIzEF;QAFF,qCAAqC;QACrC,MAAMG,UACJH,CAAAA,mCAAAA,6CAAAA,0BAA2BI,KAAK,CAAC,oCAAjCJ,mCAA6D,EAAE;QACjE,MAAMK,2BAA2BF,OAAO,CAAC,EAAE,IAAIA,OAAO,CAAC,EAAE,IAAI;QAE7D,iIAAiI;QACjI,MAAMK,gBAAgBH,2BAClB,AAAC,sCAAmCA,2BAAyB,iBAC5D;QAEL,MAAMI,gBAAgB3B,sBAAsBO;QAC5C,+CAA+C;QAC/C,mEAAmE;QACnE,IAAIC,UAAUW,cAAc,EAAE;;YAC1BQ,cAAsBC,eAAe,GAAGpB,UAAUW,cAAc;QACpE;QAEA,+EAA+E;QAC/Ed,mBAAmB,YAAYE,KAAKmB;QACpCtB,kBAAkBuB;IACpB,OAAO;QACLvB,kBAAkBG;IACpB;AACF,EAAC"}