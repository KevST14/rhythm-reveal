{"version":3,"sources":["../../src/client/use-merged-ref.ts"],"sourcesContent":["import { useMemo, useRef, type Ref } from 'react'\n\n// This is a compatibility hook to support React 18 and 19 refs.\n// In 19, a cleanup function from refs may be returned.\n// In 18, returning a cleanup function creates a warning.\n// Since we take userspace refs, we don't know ahead of time if a cleanup function will be returned.\n// This implements cleanup functions with the old behavior in 18.\n// We know refs are always called alternating with `null` and then `T`.\n// So a call with `null` means we need to call the previous cleanup functions.\nexport function useMergedRef<TElement>(\n  refA: Ref<TElement>,\n  refB: Ref<TElement>\n): Ref<TElement> {\n  const cleanupA = useRef<() => void>(() => {})\n  const cleanupB = useRef<() => void>(() => {})\n\n  return useMemo(() => {\n    if (!refA || !refB) {\n      return refA || refB\n    }\n\n    return (current: TElement | null): void => {\n      if (current === null) {\n        cleanupA.current()\n        cleanupB.current()\n      } else {\n        cleanupA.current = applyRef(refA, current)\n        cleanupB.current = applyRef(refB, current)\n      }\n    }\n  }, [refA, refB])\n}\n\nfunction applyRef<TElement>(\n  refA: NonNullable<Ref<TElement>>,\n  current: TElement\n) {\n  if (typeof refA === 'function') {\n    const cleanup = refA(current)\n    if (typeof cleanup === 'function') {\n      return cleanup\n    } else {\n      return () => refA(null)\n    }\n  } else {\n    refA.current = current\n    return () => {\n      refA.current = null\n    }\n  }\n}\n"],"names":["useMemo","useRef","useMergedRef","refA","refB","cleanupA","cleanupB","current","applyRef","cleanup"],"mappings":"AAAA,SAASA,OAAO,EAAEC,MAAM,QAAkB,QAAO;AAEjD,gEAAgE;AAChE,uDAAuD;AACvD,yDAAyD;AACzD,oGAAoG;AACpG,iEAAiE;AACjE,uEAAuE;AACvE,8EAA8E;AAC9E,OAAO,SAASC,aACdC,IAAmB,EACnBC,IAAmB;IAEnB,MAAMC,WAAWJ,OAAmB,KAAO;IAC3C,MAAMK,WAAWL,OAAmB,KAAO;IAE3C,OAAOD,QAAQ;QACb,IAAI,CAACG,QAAQ,CAACC,MAAM;YAClB,OAAOD,QAAQC;QACjB;QAEA,OAAO,CAACG;YACN,IAAIA,YAAY,MAAM;gBACpBF,SAASE,OAAO;gBAChBD,SAASC,OAAO;YAClB,OAAO;gBACLF,SAASE,OAAO,GAAGC,SAASL,MAAMI;gBAClCD,SAASC,OAAO,GAAGC,SAASJ,MAAMG;YACpC;QACF;IACF,GAAG;QAACJ;QAAMC;KAAK;AACjB;AAEA,SAASI,SACPL,IAAgC,EAChCI,OAAiB;IAEjB,IAAI,OAAOJ,SAAS,YAAY;QAC9B,MAAMM,UAAUN,KAAKI;QACrB,IAAI,OAAOE,YAAY,YAAY;YACjC,OAAOA;QACT,OAAO;YACL,OAAO,IAAMN,KAAK;QACpB;IACF,OAAO;QACLA,KAAKI,OAAO,GAAGA;QACf,OAAO;YACLJ,KAAKI,OAAO,GAAG;QACjB;IACF;AACF"}